<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
    <title id="title">BTS</title>
    <link rel="icon" type="image/x-icon" href="./favicon.png?v3=2">
    <link rel="apple-touch-icon" sizes="128x128" href="/apple-touch-icon.png?v=13">
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="menu.css">
    <link rel="stylesheet" href="w3.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
</head>


<body id="body" class="center">

    <!-- SIDE MENU -->
    <!-- <div class="w3-sidebar w3-bar-block w3-xxlarge"
        style="padding-top:20px;width:70px;background-color:#272727;border-right:1px solid;_border-top:1px solid;top:0px;">
        <a href="#" class="w3-bar-item w3-button color-font"><i class="fa fa-bars"></i></a>
        <a href="#runtime" class="w3-bar-item w3-button"><i class="fa fa-th"></i></a>
        <a href="#batch" class="w3-bar-item w3-button"><i class="fa fa-table"></i></a>
        <a href="#configuration" class="w3-bar-item w3-button"><i class="fa fa-pencil-square-o"></i></a>
        <a href="#system" class="w3-bar-item w3-button"><i class="fa fa-cog"></i></a>
        <a _href="#" class="w3-bar-item _w3-button color-zero"><i class="fa fa-group"></i></a>
        <a href="#contextual-help" class="w3-bar-item w3-button"><i class="fa fa-question-circle"></i></a>
    </div> -->

    <!-- TOP -->
    <div style="">
        <div id="content" class="" style="display:none;">
            <a _href="" id="" class="w3-xlarge" style="float:right;min-width:0px;padding-left:10px;cursor:pointer;"
                onclick="showModal()"><i class="fa fa-ellipsis-v color-zero" aria-hidden="true"></i></a>

            <span class="header">
                <h1 class="color-font">

                    <!-- Sidebar -->
                    <!-- <div class="w3-sidebar w3-bar-block w3-border w3-xlarge w3-center w3-text-white"
                        style="display:none;width:300px;color:white;background-color: #1e1e1e;;top: 110px;"
                        id="mySidebar">
                        
                        <div style="background-color: #3d3d3d;border:1px solid;padding:50px;">
                            <a class="" style="color:#1599ac;" onclick=""><i class="fa fa-battery-three-quarters"
                                    aria-hidden="true"></i><br />Test System</a>
                        </div>
                        <a class="" onclick=""><i class="fa fa-cube" aria-hidden="true"></i><br />
                            Virtualization</a>
                        <hr />
                        <a class="" onclick=""><i class="fa fa-television" aria-hidden="true"></i><br />
                            Monitoring</a>
                        <hr />
                        <a class="" onclick=""><i class="fa fa-database" aria-hidden="true"></i><br /> Data
                            Processing</a>
                        <hr />
                        <a class="" onclick=""><i class="fa fa-calendar" aria-hidden="true"></i><br />
                            Scheduler</a>
                    </div> -->

                    <div class="w3-dropdown-hover" _style="">
                        <div class="" style="background-color:#272727;border:0px solid;padding-left:0px;"
                            onclick="document.getElementById('mySidebar').style.display = 'block';">
                            <i id="menu" class="fa fa-bars" style="cursor:pointer;padding-right:25px;color:#1599ac;"
                                aria-hidden="true"></i>
                        </div>
                        <div class="card-menu-options w3-dropdown-content w3-bar-block w3-border w3-xlarge"
                            style="min-width:250px;">
                            <a class="card-menu-option-selected w3-bar-item w3-button" onclick=""><i
                                    class="fa fa-battery-three-quarters" aria-hidden="true"></i> Test System</a>
                            <!-- <hr /> -->
                            <a class="card-menu-option-unselected w3-bar-item w3-button" onclick=""><i
                                    class="fa fa-cube" aria-hidden="true"></i>
                                <span class="">Virtualization</span></a>
                            <a class="card-menu-option-unselected w3-bar-item w3-button" onclick=""><i
                                    class="fa fa-television" aria-hidden="true"></i>
                                Monitoring</a>
                            <a class="card-menu-option-unselected w3-bar-item w3-button" onclick=""><i
                                    class="fa fa-database" aria-hidden="true"></i> Data Processing</a>
                            <a class="card-menu-option-unselected w3-bar-item w3-button" onclick=""><i
                                    class="fa fa-calendar" aria-hidden="true"></i>
                                Scheduler</a>
                        </div>
                    </div>
                    <span class=""><span class="color-zero" style="display:none;">Test System:&nbsp;&nbsp;</span>TS0937
                        - <span id="view" class="" style="_padding-left:65px;">Runtime </span>
                        <span class="">
                            <div class="w3-dropdown-hover  w3-xlarge" style="background-color:#2f2f2f;">
                                <i class="fa fa-caret-down w3-xxlarge"
                                    style="padding-left:20px;color:white;background-color:#272727;"
                                    aria-hidden="true"></i>
                                <div class="w3-dropdown-content w3-bar-block w3-border w3-xlarge"
                                    style="background-color:#2f2f2f;color:white;min-width:250px;">
                                    <a href="#runtime" class="w3-bar-item w3-button"><i class="fa fa-th"
                                            aria-hidden="true"></i> Runtime</a>
                                    <a href="#batch" class="w3-bar-item w3-button"><i class="fa fa-table"
                                            aria-hidden="true"></i> Batch Operations</a>
                                    <a href="#configuration" class="w3-bar-item w3-button"><i
                                            class="fa fa-pencil-square-o" aria-hidden="true"></i> Setup</a>
                                    <a href="#system" class="w3-bar-item w3-button"><i class="fa fa-cog"
                                            aria-hidden="true"></i> System</a>
                                    <a href="#contextual-help" class="w3-bar-item w3-button"><i
                                            class="fa fa-question-circle" aria-hidden="true"></i> Help</a>
                                </div>
                            </div>
                        </span>

                        <!--  -->
                    </span>
                </h1>
                <img class="logo2" src="/assets/avl-logo.png" />
            </span>

            <div id="overview-counts" class="w3-row w3-center _w3-right-align" style="padding-top:20px;">
                <div class="w3-col s1 w3-left-align">
                    <span class="color-font w3-xlarge">
                        <div class="w3-dropdown-hover  w3-xlarge" _style="">
                            <div class="" style="background-color:#1e1e1e;color:white;border:0px solid;"><i id="filter"
                                    class="fa fa-filter" style="cursor:pointer;"
                                    aria-hidden="true">&nbsp;&nbsp;&nbsp;All
                                </i><i class="fa fa-caret-down" style="padding-left:20px;" aria-hidden="true"></i></div>
                            <div class="w3-dropdown-content w3-bar-block w3-border w3-xlarge"
                                style="background-color:#2f2f2f;color:white;">
                                <a class="w3-bar-item w3-button" onclick="filter('')">All</a>
                                <a class="w3-bar-item w3-button" onclick="filter('Project A')">Project A</a>
                                <a class="w3-bar-item w3-button" onclick="filter('Project B')">Project B</a>
                                <a class="w3-bar-item w3-button" onclick="filter('Project C')">Project C</a>
                                <a class="w3-bar-item w3-button" onkeyup="filter(this.value)"><input type="text"
                                        placeholder="Search..."></input></a>
                            </div>
                        </div>
                    </span>
                </div>
                <div id="filter_on_test" class="w3-col s2 clickable w3-xlarge" onclick="filterRuntime('on_test')">
                    <span class="color-font">On Test: <span id="count_on_test" class=""
                            style="font-weight:bold;margin-left:10px;">41</span></span>
                </div>
                <div id="filter_paused" class="w3-col s2 clickable w3-xlarge" onclick="filterRuntime('paused')">
                    <span class="color-font">Paused: <span id="count_paused" class=""
                            style="font-weight:bold;margin-left:10px;">7</span></span>
                </div>
                <div id="filter_empty" class="w3-col s2 clickable w3-xlarge" onclick="filterRuntime('empty')">
                    <span class="color-font">Empty: <span id="count_empty" class=""
                            style="font-weight:bold;margin-left:10px;">0</span></span>
                </div>
                <div id="filter_complete" class="w3-col s2 clickable w3-xlarge" onclick="filterRuntime('complete')">
                    <span class="color-font">Complete: <span id="count_complete" class=""
                            style="font-weight:bold;margin-left:10px;">9</span></span>
                </div>
                <div id="filter_error" class="w3-col s2 clickable w3-xlarge" onclick="filterRuntime('error')">
                    <span class="color-font">Errors: <span id="count_error" class=""
                            style="font-weight:bold;margin-left:10px;">0</span></span>
                </div>
                <div id="runtime-select-view" class="w3-col s1 clickable w3-xlarge" style="display:none;">
                    <div class="w3-dropdown-hover w3-right" _style="">
                        <div class="" style="background-color:#272727;color:white;border:0px solid;padding-left:30px;">
                            <i id="menu" class="fa fa-ellipsis-v w3-xlarge" style="cursor:pointer;"
                                aria-hidden="true"></i>
                        </div>
                        <div class=" w3-dropdown-content w3-bar-block w3-border w3-xlarge"
                            style="right:0;width:125px;min-width:250px;background-color:#2f2f2f;color:white;">
                            <a id="menu-view-large" class="w3-bar-item w3-button" onclick="selectCardType('large')"><i
                                    class="fa fa-area-chart" aria-hidden="true"></i> Large
                                Card</a>
                            <a id="menu-view-small" class="w3-bar-item w3-button" onclick="selectCardType('small')"><i
                                    class="fa fa-list-alt" aria-hidden="true"></i> Small
                                Card</a>
                            <a id="menu-view-table" class="w3-bar-item w3-button" onclick="selectCardType('table')"><i
                                    class="fa fa-table" aria-hidden="true"></i> Table</a>
                            <a id="menu-view-timeline" class="w3-bar-item w3-button"
                                onclick="selectCardType('timeline')"><i class="fa fa-table" aria-hidden="true"></i>
                                Timeline</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARDS -->
        <div id="cards" class="w3-row" style="display:none;margin-bottom:25px;padding-bottom:50px;">
            <hr />
            <!-- <div class="w3-container w3-xlarge color-font"
                style="border-top:1px solid#c5c5c5;margin-top:8px;padding-top:10px;padding-right:6px;margin-bottom:10px;">
                <div class="w3-col s4">
                    &nbsp;
                </div>
                <div class="w3-col s1 w3-center color-zero"><i class="fa fa-play" aria-hidden="true"></i></div>
                <div class="w3-col s1 w3-center color-zero"><i class="fa fa-pause" aria-hidden="true"></i></div>
                <div class="w3-col s1 w3-center color-zero"><i class="fa fa-stop" aria-hidden="true"></i></div>
                <div class="w3-col s1 w3-center color-zero"><i class="fa fa-eject" aria-hidden="true"></i></div>

            </div> -->

            <!-- TABLE -->
            <div id="table-view" class="w3-col s12 w3-large" style="display:block;">
                <table class="w3-table w3-bordered w3-xlarge">
                    <tr class="color-font">
                        <!-- <th><i class="fa fa-square-o" aria-hidden="true"></i></th> -->
                        <th>Channel</th>
                        <th>State</th>
                        <th>Serial Number</th>
                        <th>Test Procedure</th>
                        <th>Step Name</th>
                        <th>V</th>
                        <th>I (mA)</th>
                        <th>t (h)</th>
                        <th>Cycles</th>
                        <!-- <th></th> -->
                    </tr>
                    <tr w3-repeat="items" id="table-row-{{name}}" onclick="clickRow(this.rowIndex)"
                        style="cursor:pointer;">
                        <!-- <td><i class="fa fa-square-o" aria-hidden="true"></i></td> -->
                        <td class="color-moniker"><img src="{{icon}}" height="35" style="padding-right:10px;" /><span
                                style="padding-right:10px;">{{name}}</span></td>
                        <td>{{batch_state}}</td>
                        <td>{{uut}}</td>
                        <td>{{test}}</td>
                        <td>{{step}}</td>
                        <td class="color-voltage">{{v}}</td>
                        <td class="color-current">{{i}}</td>
                        <td class="color-time">{{st}}</td>
                        <td>
                            <div class="" style="display:flex;align-items:center;border-radius:30px;">
                                <div id="{{name}}-progress-complete-table" class=""
                                    style="max-height:15px;background-color:rgb(106, 190, 223);">&nbsp;
                                </div>
                                <div id="{{name}}-progress-requested-table" class=""
                                    _style="max-height:15px;background-color:pink;">
                                </div>
                                <div style="padding-left:10px;">{{cycles}}</div>
                            </div>
                        </td>
                        <!-- <td><span class="color-current">{{cycles}}</span> / <span class="color-time">50</span></td> -->
                        <!-- <td><i class="fa fa-pause color-font" style="cursor:pointer;" aria-hidden="true"></i></td> -->
                    </tr>
                </table>
            </div>

            <!-- LARGE / SMALL CARDS -->
            <div id="card-view" class="w3-col s12 w3-large"
                style="display:flex;flex-direction:row;flex-wrap:wrap;justify-content: left;">
                <div w3-repeat="items" class="w3-col s12 m3 l2"
                    style="display:block;max-width:305px;min-width:305px;padding:12px;">
                    <div id="{{name}}" class="card w3-padding w3-card" onclick="clickCard(this.id)">
                        <div class="" style="padding-bottom:10px;font-size:28px;">
                            <img id="card-icon-{{name}}" src="{{icon}}" height="35"
                                style="padding-right:10px;display:none;" />
                            <span id="card-name-{{name}}" class="color-moniker" style="">{{name}}</span>
                            <span id="" class="color-moniker w3-right"
                                style="margin-top:8px;font-size:20px !important;">{{uut}}</span>
                        </div>

                        <div class="_w3-center" style="padding-bottom:10px;">
                            <span><b>{{batch_state}}</b>
                                <span class="w3-right">
                                    <span class="">{{cycles}}</span>
                                    <span class=""> / </span>
                                    <span class="color-current">{{requested_cycles}}</span>
                                    <!-- <div class="" style="display:flex;align-items:center;border-radius:30px;">
                                    <div style="padding-right:20px;">{{cycles}}</div>
                                    <div id="{{name}}-progress-complete" class=""
                                        style="max-height:15px;background-color:rgb(106, 190, 223);">&nbsp;
                                    </div>
                                    <div id="{{name}}-progress-requested" class=""
                                        style="max-height:15px;background-color:#6abedf1a;">
                                        &nbsp;</div>
                                    <div style="padding-left:10px;">{{requested_cycles}}</div>
                                </div> -->
                                </span>
                                <br />
                        </div>

                        <span id="card-view-"
                            style="font-size:20px;margin-top:3px;display:flex;flex-direction: row;flex-wrap: nowrap;justify-content: space-between;">
                            <span class="color-voltage">{{v}}V</span>
                            <span class="color-current">{{i}}A</span>
                            <span class="color-time">{{st}}h</span>
                        </span>

                        <span class="w3-medium" style="display:flex;justify-content: space-between;display:none;">
                            <!-- <span class="color-current">{{uut}}</span> -->
                            <span style="_font-size:12px;margin-top:3px;">
                                <span class="color-current">{{cycles}}</span>
                                <span class="color-font"> / </span>
                                <span class="color-time">50</span>
                            </span>
                        </span>

                        <div id="card-chart-{{name}}" name="card-chart" style="margin-top:3px;padding-top:10px;"></div>
                    </div>
                </div>
            </div>

            <!-- TIMELINE -->
            <div id="timeline-view" class="w3-col s12 w3-large" style="display:none;">
                <div id="" class="w3-col s12 w3-large" _style="display:block;">
                    <table class="w3-table w3-bordered w3-xlarge">
                        <tr class="color-font">
                            <!-- <th><i class="fa fa-square-o" aria-hidden="true"></i></th> -->
                            <th width=150>Channel</th>
                            <th width=150>State</th>
                            <th class="w3-center" style="border-left:0px solid;"> 18-Jul</th>
                            <th class="w3-center" style="border-left:1px solid;"> 19-Jul</th>
                            <th class="w3-center" style="border-left:1px solid;"> 20-Jul</th>
                            <th class="w3-center" style="border-left:1px solid;"> 21-Jul</th>
                            <th class="w3-center" style="border-left:1px solid;"> 22-Jul</th>
                            <!-- <th class="w3-center">Timeline: <spam class="color-current">Last 5 days</spam></th> -->
                        </tr>

                        <!-- TIMELINE ROWS - REPEAT -->
                        <tr id="timeline-row-{{name}}" w3-repeat="items" id="timeline-row-CH04"
                            onclick="clickRow(this.rowIndex)">
                            <td class="color-moniker"><img src="{{icon}}" height="35"
                                    style="padding-right:10px;" /><span style="padding-right:10px;">{{name}}</span></td>
                            <td>{{batch_state}}</td>
                            <td colspan="5">
                                <span class="w3-small" style="display:flex;margin-top:5px;">
                                    {{history}}
                                </span>

                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- PAGER -->
            <br />
            <div id="pages" class="w3-col s12 w3-center">
                <span id="pager" style="display:flex;justify-content:center;display:none;margin:3px;font-size:1.1rem;">
                    <span w3-repeat="pages" id="page-{{name}}" class="color-font pager-button" _style=""
                        onclick="clickPager(this.innerText)">{{name}}</span>
                    <span id="page-all" class="w3-white-text _color-font pager-button" _style=""
                        onclick="clickPager(this.innerText)">ALL</span>
                </span>
            </div>


            <div style="padding-top:25px">&nbsp;</div>

            <!-- DETAIL -->
            <div id="detail" class="w3-padding _card w3-col s12"
                style="display:none;cursor:default;background-color: #1e1e1e;_border:1px solid;">
                <div class="w3-row w3-padding">

                    <!-- COLUMN 1 -->
                    <div class="w3-col s1">
                        <span class="color-moniker w3-xxlarge"><img src="./assets/discharge.png" height="45" /> <span
                                id="detail-name">CHANNEL </span></span>
                        <br />
                        <span class="w3-large"><span id="detail-uut" class="w3-xlarge"
                                style="padding-left:30px;">UUT</span></span>
                    </div>

                    <!-- COLUMN 2 -->
                    <div class="w3-col s3 w3-padding"
                        style="_margin-top:23px;display:flex;flex-direction:column;align-items:flex-end;">
                        <!-- <span class="color-font w3-large" style="margin-top: 3px;margin-right: 10px;"><span>V | I (mA) |
                            t
                            (hrs)</span></span> -->
                        <span class="color-font" style="font-size: 28px;margin-right:10px;">
                            <span id="" class="color-voltage" style="margin-right:20px;">3.312V </span>
                            <!-- <span id="" class="color-font"> | </span> -->
                            <span id="" class="color-current" style="margin-right:20px;">-0.612A </span>
                            <!-- <span id="" class="color-font"> | </span> -->
                            <span id="" class="color-time">3.8h</span>
                        </span>
                    </div>

                    <!-- COLUMN 3 -->
                    <div class="w3-col s4" _style="display:flex;flex-direction:column;align-items:flex-start;">
                        <span class="" style="">
                            <span class="color-zero w3-large"
                                onclick="changeView('configuration',null)">Procedure:&nbsp;&nbsp;
                                <span class="w3-text-white w3-xlarge" style=""><span
                                        id="test-6-detail-test">TXW2345-02</span> <span><i
                                            class="fa fa-external-link color-current" style="padding-left:20px;"
                                            aria-hidden="true"></i></span>
                                </span>
                            </span>

                            <br />
                            <span class="" style="">
                                <span class="color-zero w3-large">Step Name:&nbsp;&nbsp;
                                    <span class="w3-text-white w3-xlarge" style="">Constant Current Charge</span>
                                </span>
                            </span>

                            <br />
                            <span class="" style="">
                                <span class="color-zero w3-large">Run Time:&nbsp;&nbsp;
                                    <span class="w3-text-white w3-xlarge" style="">21h 41m</span>
                                </span>
                            </span>

                            <br />
                            <span class="" style="">
                                <span class="color-zero w3-large">Num Cycles:&nbsp;&nbsp;
                                    <span class="w3-text-white w3-xlarge" style="">31 / 50</span>
                                </span>
                            </span>
                    </div>

                    <!-- COLUMN 4 -->
                    <div class="w3-col s4">
                        <span class="" style="">
                            <span class="color-zero w3-large">Battery:&nbsp;&nbsp;
                                <span class="w3-text-white w3-xlarge" style="">TXW2345-02 <span><i
                                            class="fa fa-external-link color-current" style="padding-left:20px;"
                                            aria-hidden="true"></i></span>
                                </span>
                                <i class="fa fa-close w3-xlarge w3-right w3-text-white clickable" aria-hidden="true"
                                    onclick="closeDetail()"> Close</i>
                            </span>

                            <br />
                            <span class="" style="">
                                <span class="color-zero w3-large">Rated Capacity:&nbsp;&nbsp;
                                    <span class="w3-text-white w3-xlarge" style="">Constant Current Charge</span>
                                </span>
                            </span>

                            <br />
                            <span class="" style="">
                                <span class="color-zero w3-large">Max Voltage:&nbsp;&nbsp;
                                    <span class="w3-text-white w3-xlarge" style="">21h 41m</span>
                                </span>
                            </span>

                            <br />
                            <span class="" style="">
                                <span class="color-zero w3-large">Max Current:&nbsp;&nbsp;
                                    <span class="w3-text-white w3-xlarge" style="">31 / 50</span>
                                </span>
                            </span>
                    </div>

                    <!-- <div class="w3-col s2" style="display:flex;flex-direction:column;align-items:flex-start;">
                    <span class="color-current w3-medium" style="margin-top: 12px;"><span class="color-font">Battery:
                        </span>2987-08 <span class="color-time">...</span></span>
                    <span class="color-current w3-medium"><span class="color-font">Rated Capacity: </span>2</span>
                    <span class="color-current w3-medium"><span class="color-font">Max Voltage: </span>3.8</span>
                    <span class="color-current w3-medium"><span class="color-font">Max Current:
                        </span>2.2</span></span>
                </div> -->

                    <!-- SCREEN GRAB & UI SWITCH -->
                    <!-- <div class="w3-col s1"
                    style="display:flex;flex-direction:row;align-items:flex-end;justify-content:flex-end;">
                    <span class="color-font" style="cursor:pointer;padding-top:5px;" onclick="closeDetail()"><i
                            class="fa fa-times w3-xlarge" aria-hidden="true"></i></span> -->

                    <!-- <span class="color-font" style="cursor:pointer;padding-top:5px;" onclick="copyDetail()"><i
                                class="fa fa-files-o w3-xlarge" aria-hidden="true"></i></span> -->

                    <!-- <div id="menu-detail" class="w3-dropdown-hover" style="background-color:#2f2f2f00;">
                            <div class="w3-xlarge" style="background-color:#2f2f2f00;border:0px solid;;">
                                <i id="menu" class="fa fa-bars color-font" style="cursor:pointer;"
                                    aria-hidden="true"></i>
                            </div>
                            <div class="card-menu-options w3-dropdown-content w3-bar-block w3-border w3-medium"
                                style="right:0;z-index:99999;">
                                <a class="card-menu-option-selected w3-bar-item w3-button"
                                    onclick="selectChartType('I')">Runtime</a>
                                <a class="card-menu-option-unselected w3-bar-item w3-button"
                                    onclick="selectChartType('V')">Parameters</a>
                                <a class="card-menu-option-unselected w3-bar-item w3-button"
                                    onclick="selectChartType('I')">Test Definition</a>
                                <a class="card-menu-option-unselected w3-bar-item w3-button"
                                    onclick="selectChartType('T')">Data Analysis</a>
                            </div>
                        </div> -->

                </div>

                <div class="w3-col s12">
                    <div class="w3-container" style="padding-top:30px;">
                        <!-- <hr />
                        <div class="w3-col s12 w3-center" _style="">
                            <span><i class="fa fa-play w3-xlarge color-zero" aria-hidden="true"
                                    style="padding:5px 25px 15px 25px;"></i></span>
                            <span><i class="fa fa-pause w3-xlarge color-font" aria-hidden="true"
                                    style="padding:5px 25px 15px 25px;"></i></i></span>
                            <span><i class="fa fa-eject w3-xlarge color-zero" aria-hidden="true"
                                    style="padding:5px 25px 15px 25px;"></i></i></span>
                        </div> -->

                        <!-- CALCULATED FIELDS -->
                        <div class="w3-padding" style="display:flex;flex-direction:row;justify-content:space-between;">
                            <div class="w3-col s2 color-font w3-xlarge w3-padding"
                                style="width:20%;border:2px solid rgb(138, 138, 138);">Dis Eng<span
                                    class="color-current" style="float:right;">1 Wh</span></div>
                            <div class="w3-col s2 color-font w3-xlarge w3-padding"
                                style="width:20%;border:2px solid rgb(138, 138, 138);">Dis Cap<span
                                    class="color-current" style="float:right;">82 Ah</span></div>
                            <div class="w3-col s2 color-font w3-xlarge w3-padding"
                                style="width:20%;border:2px solid rgb(138, 138, 138);">EE<span class="color-current"
                                    style="float:right;">82 %</span></div>
                            <div class="w3-col s2 color-font w3-xlarge w3-padding"
                                style="width:20%;border:2px solid rgb(138, 138, 138);">CE<span class="color-current"
                                    style="float:right;">99 %</span></div>
                            <div class="w3-center w3-col s2 color-font w3-xlarge w3-padding"
                                style="width:15%;border:2px solid rgb(138, 138, 138);"><i class="fa fa-clock-o"
                                    aria-hidden="true"></i> Recent <i class="fa fa-caret-down"
                                    aria-hidden="true"></i><span class="color-current" style="float:right;"></span>
                            </div>
                        </div>

                        <!-- TOP CHART -->
                        <span _style="">
                            <div class=""
                                style="height:0px;float:right;padding-right:20px;position:relative;z-index:9999;_padding-top:20px;">
                                <div id="menu-detail" class="w3-dropdown-hover" style="background-color:#2f2f2f00;">
                                    <div class="w3-xlarge"
                                        style="background-color:#272727;border:0px solid;margin-left:30px;">
                                        <i id="menu" class="fa fa-ellipsis-v color-font" style="cursor:pointer;"
                                            aria-hidden="true"></i>
                                    </div>
                                    <div class="card-menu-options w3-dropdown-content w3-bar-block w3-border w3-medium"
                                        style="right:0">
                                        <a class="w3-bar-item w3-button w3-text-white"
                                            onclick="selectChartType('V')">V</a>
                                        <a class=" w3-text-whitew3-bar-item w3-button w3-text-white"
                                            onclick="selectChartType('I')">I</a>
                                        <a class="w3-bar-item w3-button w3-text-white"
                                            onclick="selectChartType('T')">T°</a>
                                        <a class="w3-bar-item w3-button w3-text-white"
                                            onclick="selectChartType('T')">E</a>
                                        <a class="w3-bar-item w3-button w3-text-white"
                                            onclick="selectChartType('T')">P</a>
                                    </div>
                                </div>
                            </div>
                        </span>
                        <div id="chart-detail-1" style="margin-top:3px;margin-bottom:20px;"></div>

                        <!-- BOTTOM CHART -->
                        <span _style="">
                            <div class=""
                                style="height:0px;float:right;padding-right:20px;position:relative;z-index:9999;">
                                <div id="menu-detail" class="w3-dropdown-hover" style="background-color:#2f2f2f00;">
                                    <div class="w3-xlarge"
                                        style="background-color:#272727;border:0px solid;margin-left:30px;;">
                                        <i id="menu" class="fa fa-ellipsis-v color-font" style="cursor:pointer;"
                                            aria-hidden="true"></i>
                                    </div>
                                    <div class="card-menu-options w3-dropdown-content w3-bar-block w3-border w3-medium"
                                        style="right:0">
                                        <a class="w3-bar-item w3-button w3-text-white"
                                            onclick="selectChartType('V')">V</a>
                                        <a class="w3-bar-item w3-button w3-text-white"
                                            onclick="selectChartType('I')">I</a>
                                        <a class="w3-bar-item w3-button w3-text-white"
                                            onclick="selectChartType('T')">T°</a>
                                        <a class="w3-bar-item w3-button w3-text-white"
                                            onclick="selectChartType('T')">E</a>
                                        <a class="w3-bar-item w3-button w3-text-white"
                                            onclick="selectChartType('T')">P</a>
                                    </div>
                                </div>
                            </div>
                        </span>
                        <div id="chart-detail-2" style="margin-top:3px;margin-bottom:20px;"></div>

                        <!-- ADDITIONAL CHANNELS -->
                        <div class="w3-container w3-padding _color-zero w3-text-white w3-large"
                            style="display:flex;flex-direction:row;justify-content:space-around;">
                            <div class="w3-card w3-padding w3-col s2" style="border:1px solid #cecece;">
                                <span style="_margin:15px;">POUCH_TAB_POS</span><br />
                                <span class="w3-right w3-xlarge color-current" style="_margin:15px;">27.31 <span
                                        class="color-font">°C</span></span>
                            </div>
                            <div class="w3-card w3-padding w3-col s2" style="border:1px solid #cecece;">
                                <span style="_margin:15px;">POUCH_TAB_NEG</span><br />
                                <span class="w3-right w3-xlarge color-current" style="_margin:15px;">27.33 <span
                                        class="color-font">°C</span></span>
                            </div>
                            <div class="w3-card w3-padding w3-col s2" style="border:1px solid #cecece;">
                                <span style="_margin:15px;">POUCH_BOTTOM_LEFT</span><br />
                                <span class="w3-right w3-xlarge color-current" style="_margin:15px;">27.32 <span
                                        class="color-font">°C</span></span>
                            </div>
                            <div class="w3-card w3-padding w3-col s2" style="border:1px solid #cecece;">
                                <span style="_margin:15px;">POUCH_BOTTOM_RIGHT</span><br />
                                <span class="w3-right w3-xlarge color-current" style="_margin:15px;">27.35 <span
                                        class="color-font">°C</span></span>
                            </div>
                            <div class="w3-card w3-padding w3-col s2" style="border:1px solid #cecece;">
                                <span style="_margin:15px;">POUCH_CENTER</span><br />
                                <span class="w3-right w3-xlarge color-current" style="_margin:15px;">27.28 <span
                                        class="color-font">°C</span></span>
                            </div>
                        </div>
                        &nbsp;<br />
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- BATCH OPERATIONS -->
    <div id="view-batch" style="display:none;margin-left:0px;background-color: #1e1e1e;">
        <hr />
        <div class="w3-container w3-padding w3-xlarge">
            <div id="batch-view" class="w3-col s12 w3-large" style="display:block;background-color:#1e1e1e;">
                <div class="w3-xxlarge w3-center color-zero" style="background-color: #1e1e1e;">
                    <span class="w3-left color-font">Channels</span>
                    <i class="fa fa-eject w3-right" aria-hidden="true" style="margin:20px;"></i>
                    <i class="fa fa-pause w3-right" aria-hidden="true" style="margin:20px;"></i>
                    <i class="fa fa-play w3-right" aria-hidden="true" style="margin:20px;"></i>
                    <i class="fa fa-folder-o w3-right clickable color-current" aria-hidden="true"
                        style="margin:20px;"></i>
                </div>
                <table class="w3-table w3-bordered w3-xlarge">
                    <tr class="color-font">
                        <!-- <th><i class="fa fa-square-o" aria-hidden="true"></i></th> -->
                        <th width="50"><i class="fa fa-square-o color-current" id="batch-row-{{name}}-select-all"
                                onclick="toggleBathSelected(this.id)" aria-hidden="true"></i></th>
                        <th>Channel</th>
                        <th>Status</th>
                        <th>Serial Number</th>
                        <th>Battery File</th>
                        <th>Test Procedure</th>
                    </tr>
                    <tr w3-repeat="items" id="batch-row-{{name}}" style="">
                        <td><i class="fa fa-square-o color-current w3-xlarge" id="batch-row-{{name}}-selected"
                                onclick="toggleBathSelected(this.id)" aria-hidden="true"></i></td>
                        <td class="color-moniker">
                            <img src="{{icon}}" height="35" style="padding-right:10px;" />
                            <!-- <span>{{state}}</span> -->
                            <span style="padding-right:10px;">{{name}}</span>
                        </td>
                        <td>{{batch_state}}</td>
                        <td>{{uut}}</td>
                        <td>{{battery}}</td>
                        <td>{{test}}</td>
                    </tr>
                </table>
            </div>

            <!-- <div class="w3-roww-padding" style="margin-top:25px;">
                <div class="w3-col s3 w3-center">&nbsp;</div>
                <div class="w3-col s2 w3-center w3-margin w3-padding" style="border:1px solid white">load battery
                </div>
                <div class="w3-col s2 w3-center w3-margin w3-padding" style="border:1px solid white">load test file
                </div>
                <div class="w3-col s2 w3-center w3-margin w3-padding" style="border:1px solid white">start test
                </div>
            </div> -->
        </div>
    </div>

    <!-- BATTERY SETUP -->
    <div id="view-battery-setup" style="display:none;margin-left:0px;">
        <hr />
    </div>

    <!-- TEST SETUP -->
    <div id="view-test-setup" style="display:none;margin-left:0px;">
        <hr />
    </div>

    <!-- SYSTEM SETUP -->
    <div id="view-system-setup" style="display:none;margin-left:0px;">
        <hr />
    </div>

    <!-- SYSTEM -->
    <div id="view-setup" style="display:none;margin-left:0px;">
        <hr />
        <div w3-include-html="system.html"></div>
    </div>

    <!-- PARAMETERS -->
    <div id="view-parameters" style="display:none;margin-left:0px;">
        <hr />
        <div w3-include-html="configuration.html"></div>
    </div>

    <!-- CONTEXTUAL HELP -->
    <div id="view-contextual-help" style="display:none;margin-left:0px;">
        <hr />
        <div w3-include-html="contextual-help.html"></div>
    </div>

    <!-- MENU -->
    <!-- <div class="navbar">
        <a class="w3-xlarge" onclick="clickBack()"><i class="fa fa-arrow-left" aria-hidden="true"></i></a>
        <a class="w3-xlarge"><i class="fa fa-users" aria-hidden="true"></i></a>
        <a href="#runtime" id="runtime" class="w3-xlarge card-menu-option-selected" _style=""
            onclick="changeView('runtime', this)"><i class="fa fa-th" aria-hidden="true"></i> Runtime</a>
        <a href="#batch" id="batch" class="w3-xlarge" _style="" onclick="changeView('batch', this)"><i
                class="fa fa-table" aria-hidden="true"></i> Batch Operations</a>
        <a href="#contextual-help" id="contextual-help" class="w3-xlarge" style="float:right;"
            onclick="changeView(this.id, this)"><i class="fa fa-question-circle" aria-hidden="true"></i></a>
        <a href="#system" id="system" class="w3-xlarge" style="float:right;" onclick="changeView(this.id, this)"><i
                class="fa fa-cog" aria-hidden="true"></i></a>
        <a href="#configuration" id="configuration" class="w3-xlarge" style="float:right;min-width:0px;"
            onclick="changeView(this.id, this)"><i class="fa fa-pencil-square-o" aria-hidden="true"></i>
            Configuration</a>
        <a href="#battery-setup" id="battery-setup" class="w3-xlarge" style="float:right;display:none;"
            onclick="changeView(this.id, this)"><i class="fa fa-battery-empty" aria-hidden="true"></i> Battery
            Setup</a>
    </div> -->

    </div>

    <!-- TOOLTIP -->
    <div id="tootip" class="tooltiptext"
        style="display:none;position:absolute;top:25px;left:25px;background-color:#3b3b3bd5;color:white;padding:10px;border-radius:8px;">
        Tooltip Text
    </div>

    <!-- MODAL -->
    <div id="modal" class="w3-modal w3-xlarge" style="background-color: rgba(0,0,0,0.65);">
        <div class="w3-modal-content modal-dark" style="_min-height:900px;">
            <div class="w3-container w3-padding">
                <div class="w3-row-padding">
                    <h3 class="color-time">UI Options</h3>
                    <hr />
                    <span onclick="document.getElementById('modal').style.display='none'"
                        class="w3-button w3-display-topright w3-xxlarge">&times;</span>
                    <span><i id="option-show-row-monikers" class="fa fa-toggle-on w3-xxlarge color-font w3-right"
                            aria-hidden="true" onclick="showRowMonikersOnDetailPage()"></i> Show Row Channels on Detail
                        Page</span>
                    <br />
                    <span><i id="option_show_charge_discharge" class="fa fa-toggle-on w3-xxlarge color-font w3-right"
                            aria-hidden="true" onclick="showChargeDischargeOnTimeline()"></i> Show Charge / Discharge on
                        Timeline
                        View</span>
                    <!-- <br />
                    <span><i id="option_menu_location" class="fa fa-toggle-off w3-xxlarge color-font w3-right"
                            aria-hidden="true" onclick="toggleMenuLocation()"></i> Bottom Menu</span> -->
                </div>
            </div>
            <br />
            <!-- <div class="w3-container w3-padding">
                <div class="w3-row-padding">
                    Tasks:
                    <hr />
                    <ol>
                        <li>Runtime</li>
                        <ul>
                            <li>update counts from timeline simulation</li>
                            <li>sticky filters</li>
                            <li>filter by info in battery file</li>
                        </ul>
                        <li>Runtime Detail</li>
                        <ul>[X] VCR buttons to control channel</ul>
                        <ul>... on battery set to view</ul>
                        <ul>... on test to view</ul>
                        <li>Timeline</li>
                        <ul>
                            <li>[X] create simulated history</li>
                            <li>[X] colors too bright</li>
                            <li>update column titles to last 5 days</li>
                        </ul>
                        <li>Test Setup</li>
                        <ul>
                            <li>[x] change to table (graphic still an image)</li>
                            <li>create graphic from table entries</li>
                            <li>edit modal iterations</li>
                        </ul>
                        <li>Batch Operations (needs simulation of battery files)</li>
                        <ul>
                            <li>dropdowns</li>
                            <li>honor filters</li>
                            <li>buttons that make sense vs edit row vs inline edit of row</li>
                        </ul>
                    </ol>
                </div>
            </div> -->
        </div>
    </div>

    <!-- SCRIPT IMPORTS -->
    <script src="key.js"></script>
    <script src="data/16h.js"></script>
    <script src="data/data.js"></script>
    <script src="test-setup.js"></script>
    <script src="battery-setup.js"></script>
    <script src="system.js"></script>
    <script src="configuration.js"></script>
    <script src="w3.js"></script>
    <script src="HackTimer.js"></script>
    <script src="chart-definitions/card.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.5/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>

    <script>
        if (!submit({ key: localStorage.getItem('key') })) {
            window.location.href = `./auth.html`;
        } else {
            // setTimeout(() => { window.location.reload() }, 15 * 1000)
        }
    </script>

    <script>
        // console.log(navigator.userAgent);
        const now = Date.now();
        let show_row_monikers = localStorage.getItem('show_row_monikers') === 'true' ? true : false;
        showRowMonikersOnDetailPage(false);
        let show_charge_discharge = localStorage.getItem('show_charge_discharge') === 'false' ? false : true;
        showChargeDischargeOnTimeline(false);
        let card_type = localStorage.getItem('card_type') || 'large';
        // let menu_location_bottom = localStorage.getItem('menu_location_bottom') === 'true' ? true : false;
        // toggleMenuLocation(false);

        // DATA
        const chartData = new data();
        let cards = { items: [] };
        let on_test = 0;
        let paused = 0;
        let empty = 0;
        let complete = 0;
        let error = 0;
        const numChannels = 48;
        for (let x = 1; x <= numChannels; x++) {
            const offset = (Math.random() * 700);
            const count = 800;
            const uut = `${(Math.random() * 10000).toFixed().padStart(4, '0')}-${(Math.random() * 100).toFixed().padStart(2, '0')}`
            const test = '19d C/2 Charge - Discharge (6)';
            const dataV = chartData.getData('v', offset, count).reverse();
            let dataI = chartData.getData('i', offset, count).reverse();
            dataI.forEach((v) => {
                v = -v;
            })

            const v = dataV[dataV.length - 1].toString().padEnd(5, '0');
            const i = dataI[dataI.length - 1].toString().padEnd(5, '0');
            const isCharging = dataI[dataV.length - 1] > 0;
            let state = null;

            let history = '';
            const temp = chartData.getHistory(x + Math.round(Math.random() * 10));
            temp.forEach((h, index) => {
                const pct = h.hours / 120;
                const hours = 120 * pct;

                history += `
                    <div class="_w3-dropdown-hover ${h.className}" style="width:${hours}%;opacity:100%;">
                        &nbsp;
                        <!--<div class="w3-dropdown-content w3-xlarge"
                            style="width:400px;color:#cecece;background-color:black;opacity:100%;">
                            <span style="padding-left:15px;opacity:100%;">a bunch of info</span>
                        </div>-->
                    </div>
                `;

                if (index === temp.length - 1) {
                    if (h.className === 'charge' || h.className === 'discharge' || h.className === 'on-test') { on_test++; state = 'on_test'; }
                    if (h.className === 'paused') { paused++; state = 'paused'; state = 'paused'; }
                    if (h.className === '') { complete++; state = 'complete'; state = 'complete'; }
                    if (h.className === 'empty') { empty++; state = 'empty'; state = 'empty'; }
                    if (h.className === 'error') { error++; state = 'error'; state = 'error'; }
                }

            })

            cards.items.push({
                name: `CH${x < 10 ? '0' + x : x}`,
                icon: isCharging ? './assets/charge.png' : './assets/discharge.png',
                // data: chartData.getData('v', (Math.random() * 100), 50),
                v,
                i,
                st: (8 * Math.random()).toString().substring(0, 3), /** step time */
                dataV,
                dataI,
                chart_options: JSON.parse(JSON.stringify(card_chart_options)),
                uut,
                test,
                step: isCharging ? 'CC Charge' : 'CC Discharge',
                battery: `LG-23463-${uut}`,
                cycles: Math.floor(50 * Math.random()),
                requested_cycles: 50,
                de: null,
                dc: null,
                ee: null,
                ce: null,
                state,
                history,
            });
        }
        const numPages = Math.ceil(cards.items.length / 6);
        const temp = { pages: [] };
        for (let x = 1; x <= numPages; x++) {
            temp.pages.push({ name: x.toString() });
        }
        cards.pages = temp.pages;


        // /** UPDATE COUNTS */
        let elem = document.getElementById('count_on_test');
        elem.innerText = on_test;
        elem.classList.add(on_test > 0 ? 'color-current' : 'color-zero')

        elem = document.getElementById('count_paused');
        elem.innerText = paused;
        elem.classList.add(paused > 0 ? 'color-current' : 'color-zero')

        elem = document.getElementById('count_complete');
        elem.innerText = complete;
        elem.classList.add(complete > 0 ? 'color-current' : 'color-zero')

        elem = document.getElementById('count_empty');
        elem.innerText = empty;
        elem.classList.add(empty > 0 ? 'color-current' : 'color-zero')

        elem = document.getElementById('count_error');
        elem.innerText = error;
        elem.classList.add(error > 0 ? 'color-current' : 'color-zero')

        // /** ALTER CARDS BASED ON STATE */
        cards.items.forEach((v) => {
            if (v.state === 'empty') {
                v.icon = './assets/charge-empty.png';
                v.test = '';
                v.step = '';
                v.battery = '';
                v.dataV = [];
                v.dataI = [];
                v.v = '';
                v.i = ''
                v.st = '';
                v.cycles = '0';
                v.requested_cycles = '0';
                v.uut = `<span class="color-zero"></span>`;
                v.batch_state = '<span class="color-zero">EMPTY</span>';
            }
            if (v.state === 'error') {
                v.icon = './assets/error.png';
                v.test = '';
                v.step = '';
                v.battery = '';
                v.dataV = [];
                v.dataI = [];
                v.v = '';
                v.i = ''
                v.st = '';
                v.cycles = '';
                v.requested_cycles = '';
                // v.uut = '<span style="color:red">ERROR</span>';
                v.batch_state = '<span style="color:red">ERROR</span>';
            }
            if (v.state === 'paused') {
                v.icon = './assets/paused.png';
                v.batch_state = '<span class="w3-text-yellow">PAUSED</span>';
                v.step = '';
                start = Math.floor(150 * Math.random());
                for (let y = start; y >= 0; y--) {
                    v.dataV[v.dataV.length - y] = null; // v.dataV[start] ;
                    v.dataI[v.dataI.length - y] = null; // 0 ;
                }
            }
            if (v.state === 'complete') {
                v.icon = './assets/empty.png';
                v.batch_state = '<span class="color-current">COMPLETE</span>';
                v.step = '';
                v.cycles = '50';
                start = Math.floor(150 * Math.random());
                for (let y = start; y >= 0; y--) {
                    v.dataV[v.dataV.length - y] = null; // v.dataV[start] ;
                    v.dataI[v.dataI.length - y] = null; // 0 ;
                }
            }
            if (v.state === 'on_test') {
                v.batch_state = '<span class="w3-text-green">ON TEST</span>';
            }
        })

        document.getElementById('content').style.display = 'block';
        w3.displayObject("cards", cards);
        w3.displayObject("batch-view", cards);
        selectCardType(card_type);


        /** ALTER CARDS BASED ON STATE */
        cards.items.forEach((v) => {
            if (!v.icon.endsWith('empty.png')) {
                document.getElementById(`card-icon-${v.name}`).style.display = ''
            }

            //     if (v.state === 'error') {
            //         document.getElementById(v.name).style.borderColor = 'red';
            //         document.getElementById(v.name).style.backgroundColor = '#ff000021';
            //         document.getElementById(`card-chart-${v.name}`).style.display = 'none';
            //     }
            //     if (v.state === 'empty') {
            //         // document.getElementById(v.name).style.borderColor = '#f9f9f963';
            //         // document.getElementById(v.name).style.backgroundColor = '#64646421';
            //         document.getElementById(`card-chart-${v.name}`).style.display = 'none';
            //         const elem = document.getElementById(`card-name-${v.name}`);
            //         elem.classList.remove('color-moniker');
            //         elem.classList.add('color-zero');
            //     }
        })

        w3.includeHTML(() => {
            const searchParams = new URLSearchParams(window.location.search);
            init();
        });

        function update(onDemand = false) {
            // this.get(`${config.urlLocationTracking}/status/${config.facility}/*/true?token=123`).then((v) => {
            //     if (!onDemand) {
            //         setTimeout(() => { update(); }, 5000);
            //     }
            // });

            cards.items.forEach((v) => {
                updateChart(v.name, v.dataV, v.chart_options);

                /** update percent complete */
                const pct = 100 * (v.cycles / v.requested_cycles);
                // let elem = document.getElementById(`${v.name}-progress-complete`);
                // elem.style.width = `${pct}%`;
                // elem = document.getElementById(`${v.name}-progress-requested`);
                // elem.style.width = `${100 - pct}%`;

                let elem = document.getElementById(`${v.name}-progress-complete-table`);
                elem.style.width = `${pct}%`;
                elem = document.getElementById(`${v.name}-progress-requested-table`);
                elem.style.width = `${100 - pct}%`;
            })
        }

        let chartDetailV = null;
        let chartDetailI = null;
        let monikers = {};
        function init() {
            update();

            // QR CODE
            const qrcode = new QRCode(document.getElementById('qrcode'), {
                // text: 'https://offsite-ryan.github.io/xct/#runtime',
                text: window.location.origin + window.location.pathname + '#runtime',
                width: 175,
                height: 175,
                colorDark: '#fff',
                colorLight: '#000',
                correctLevel: QRCode.CorrectLevel.H
            });

            card_chart_options.chart.height = '250';
            card_chart_options.series[0].name = 'V';
            card_chart_options.chart.sparkline.enabled = false;
            card_chart_options.tooltip.enabled = true;
            card_chart_options.chart.toolbar.show = false;
            card_chart_options.chart.id = 'chart-detail-1';
            card_chart_options.yaxis[0].min = 2;
            card_chart_options.yaxis[0].max = 5;
            card_chart_options.yaxis[0].title.text = 'Voltage';
            card_chart_options.yaxis[0].show = true;
            card_chart_options.chart.type = 'line';
            delete card_chart_options.fill;
            card_chart_options.colors = ['#adff2f'];

            card_chart_options.series[0].data = cards.items[0].dataV;
            chartDetailV = new ApexCharts(document.getElementById(`chart-detail-1`), card_chart_options);
            chartDetailV.render();

            card_chart_options.series[0].name = 'I';
            card_chart_options.stroke.curve = 'stepline';
            card_chart_options.chart.toolbar.show = false;
            card_chart_options.chart.id = 'chart-detail-2';
            card_chart_options.yaxis[0].min = -1;
            card_chart_options.yaxis[0].max = 1;
            card_chart_options.yaxis[0].title.text = 'Current';
            card_chart_options.colors = ['#75e0f0'];

            card_chart_options.series[0].data = cards.items[0].dataI;
            chartDetailI = new ApexCharts(document.getElementById(`chart-detail-2`), card_chart_options);
            chartDetailI.render();


            showView();
        }

        // ----- SHOW DETAIL -----
        function clickRow(rowNum) {
            const name = `CH${rowNum.toString().padStart(2, '0')}`
            clickCard(name);

            cards.items.forEach((v) => {
                document.getElementById(`table-row-${v.name}`).classList.remove('table-row-selected');
            })

            document.getElementById(`table-row-${name}`).classList.add('table-row-selected');
            // /* ENABLE WHEN TIMELINE TESTBEDS EXIST */
            document.getElementById(`timeline-row-${name}`).classList.add('table-row-selected');
        }
        function clickCard(name) {

            document.getElementById('title').innerText = `BTS - ${name}`
            const channel = name.replace('CH', '');
            const channelNum = +(channel);

            location.hash = `#detail-${name}`;

            const row = Math.floor((channelNum % 6 === 0) ? (channelNum / 6) - 1 : channelNum / 6);
            let col = +(name.substring(2)) - (row * 6);
            col = col === 0 ? 5 : col - 1;
            console.log(name, row, col);

            const start = row * 6;
            const end = start + 6;
            // console.log(start, end);

            // let filtered = { items: [] };
            // filtered = { items: cards.items.filter((v, i) => i >= start && i < end) };
            // filtered.pages = temp.pages;
            // w3.displayObject("cards", filtered);
            document.getElementById('cards').style.display = '';
            // filtered.items.forEach((v) => {
            //     updateChart(v.name, v.dataV, v.chart_options);
            // })

            document.getElementById('detail').style.display = '';
            document.getElementById('overview-counts').style.display = '';

            // document.getElementById('card-view').style.display = 'none';
            // document.getElementById('table-view').style.display = 'none';
            // document.getElementById('pager').style.display = 'none';

            const selected = cards.items.find((v) => v.name === name);
            document.getElementById('test-6-detail-test').innerHTML = selected.test;

            let indexCards = 0;
            let countCards = 0
            for (let x = 1; x <= numChannels; x++) {
                elem = document.getElementById(`CH${x.toString().padStart(2, '0')}`);
                elem.classList.remove('card-selected');
                countCards += elem.parentElement.classList.contains('w3-hide') ? 0 : 1;
                if (elem.id === name) {
                    indexCards = countCards;
                }
            }
            chartDetailV.updateSeries([{ data: selected.dataV }]);
            chartDetailI.updateSeries([{ data: selected.dataI }]);


            document.getElementById(name).classList.add('card-selected');
            document.getElementById('detail-name').innerText = name;
            document.getElementById('detail-uut').innerHTML = selected.uut;
            document.getElementById('pager').style.display = 'none';

            // selectCardType(card_type);
            // selectPage(row + 1);

            // HIDE TOP ON DETAIL
            if (!show_row_monikers) {
                document.getElementById('card-view').style.display = 'none';
                document.getElementById('table-view').style.display = 'none';
                document.getElementById('timeline-view').style.display = 'none';
                document.getElementById('pager').style.display = 'none';
            }

            elem = document.getElementById('card-view');
            elem.style.flexFlow = '';
            elem.style.justifyContent = 'flex-start';
            elem.style.overflowX = 'scroll';
            // elem.style.marginBottom = '40px;';
            elem.style.scrollbarColor = '#5d5d5d #2f2f2f';
            elem.scrollLeft = document.getElementById('card-view').scrollWidth * ((indexCards - 1) / countCards);

            elem = document.getElementById('table-view');
            elem.style.maxHeight = '300px';
            elem.style.overflowY = 'scroll';
            elem.style.scrollbarColor = '#5d5d5d #2f2f2f';
            elem.scrollTop = indexCards * 53.5

            elem = document.getElementById('timeline-view');
            elem.style.maxHeight = '300px';
            elem.style.overflowY = 'scroll';
            elem.style.scrollbarColor = '#5d5d5d #2f2f2f';
            elem.scrollTop = indexCards * 53.5
        }

        function closeDetail() {
            document.getElementById('detail').style.display = 'none';
            document.getElementById('overview-counts').style.display = '';
            document.getElementById('pager').style.display = 'none';

            for (let x = 1; x <= numChannels; x++) {
                document.getElementById(`CH${x.toString().padStart(2, '0')}`).classList.remove('card-selected');
            }
            let elem = document.getElementById('card-view');
            elem.style.flexDirection = 'row';
            elem.style.flexWrap = 'wrap';
            elem.style.justifyContent = 'center';
            elem.style.overflowX = '';

            document.getElementById('table-view').style.maxHeight = '';
            cards.items.forEach((v) => {
                document.getElementById(`table-row-${v.name}`).classList.remove('table-row-selected');
            })

            document.getElementById('timeline-view').style.maxHeight = '';
            cards.items.forEach((v) => {
                document.getElementById(`timeline-row-${v.name}`).classList.remove('table-row-selected');
            })
            location.hash = `#runtime`;
        }

        function updateChart(name, data, chart_options) {
            chart_options.series[0].data = data;
            // card_chart_options.chart.sparkline.enabled = true;
            var chart = new ApexCharts(document.getElementById(`card-chart-${name}`), chart_options);
            chart.render();
        }

        // Define the function to screenshot the div
        function copyDetail() {
            update = false;
            let div = document.getElementById('detail');
            div.scrollIntoView();

            // Use the html2canvas function to take a screenshot and append it to the output div
            html2canvas(div).then(
                function (canvas) {
                    canvas.toBlob(function (blob) {
                        const item = new ClipboardItem({ "image/png": blob });
                        navigator.clipboard.write([item]);
                    });
                })
        }

        // ----- CLICK PAGER -----
        function clickPager(v) {
            if (v === 'ALL') {
                closeDetail()
            } else {
                console.log(+(v));
                const row = (+v);
                const channel = (((row - 1) * 6) + 1).toString().padStart(2, '0');
                console.log(`CH${channel}`);
                clickCard(`CH${channel}`);
                selectPage(v);
            }
        }

        function selectPage(num) {
            const elem = document.getElementById(`page-${num}`);
            elem.style.fontWeight = 'bold';
            elem.style.fontSize = '1.3rem';
            elem.classList.remove('color-font');
            elem.classList.add('color-current');
        }

        function selectCardType(type) {
            // document.styleSheets[1].cssRules[6].style.minHeight = null
            // console.log(type);
            card_type = type;
            localStorage.setItem('card_type', type);

            ['menu-view-large', 'menu-view-small', 'menu-view-table', 'menu-view-timeline'].forEach((v) => {
                document.getElementById(v).classList.replace('card-menu-option-selected', 'card-menu-option-unselected');
            })
            document.getElementById(`menu-view-${type}`).classList.replace('card-menu-option-unselected', 'card-menu-option-selected');

            document.getElementById('card-view').style.display = 'none';
            document.getElementById('table-view').style.display = 'none';
            document.getElementById('timeline-view').style.display = 'none';

            if (type === 'large') {
                document.getElementById('card-view').style.display = 'flex';
                let elems = document.getElementsByName('card-chart');
                for (let e of elems) {
                    e.style.display = 'block';
                }
                elems = document.getElementsByClassName('card');
                for (let e of elems) {
                    e.style.minHeight = '275px';
                    e.style.maxHeight = '275px';
                }
            } else if (type === 'small') {
                document.getElementById('card-view').style.display = 'flex';
                let elems = document.getElementsByName('card-chart');
                for (let e of elems) {
                    e.style.display = 'none';
                }
                elems = document.getElementsByClassName('card');
                for (let e of elems) {
                    e.style.minHeight = '0px';
                }
            } else if (type === 'table') {
                document.getElementById('table-view').style.display = 'block';
            } else if (type === 'timeline') {
                document.getElementById('timeline-view').style.display = 'block';
            }
        }

        function selectChartType(type) {

        }

        function changeView(name, elem) {
            const updateMenu = (id) => {
                // ['runtime', 'batch', 'battery-setup', 'contextual-help', 'system', 'configuration'].forEach((v) => {
                //     document.getElementById(v).classList.remove('card-menu-option-selected');
                //     if (id === v) {
                //         elem.classList.add('card-menu-option-selected');
                //     }
                // })
            }
            ['cards', 'overview-counts', 'view-batch', 'view-test-setup', 'view-battery-setup', 'view-system-setup', 'view-setup', 'view-parameters', 'view-contextual-help'].forEach((v) => {
                document.getElementById(v).style.display = 'none';
            })

            if (name === 'runtime') {
                document.getElementById('title').innerText = 'BTS - Runtime'
                document.getElementById('cards').style.display = 'block';
                document.getElementById('overview-counts').style.display = 'block';
                document.getElementById('view').innerText = 'Runtime';
                document.getElementById('runtime-select-view').style.display = 'block';
                // closeDetail();
                updateMenu(name);
            } else if (name === 'batch') {
                document.getElementById('title').innerText = 'BTS - Batch'
                document.getElementById('overview-counts').style.display = 'block';
                document.getElementById('view').innerText = 'Batch Operations';
                document.getElementById('view-batch').style.display = 'block';
                document.getElementById('runtime-select-view').style.display = 'none';
                updateMenu(name);
            } else if (name === 'test-setup') {
                document.getElementById('title').innerText = 'BTS - Test Setup'
                document.getElementById('view').innerText = 'Test Setup';
                document.getElementById('view-test-setup').style.display = 'block';
                updateMenu(name);
            } else if (name === 'battery-setup') {
                document.getElementById('title').innerText = 'BTS - Battery Setup'
                document.getElementById('view').innerText = 'Battery Setup';
                document.getElementById('view-battery-setup').style.display = 'block';
                updateMenu(name);
            } else if (name === 'system-setup') {
                document.getElementById('title').innerText = 'BTS - System Setup'
                document.getElementById('view').innerText = 'System Setup';
                document.getElementById('view-system-setup').style.display = 'block';
                updateMenu(name);
            } else if (name === 'contextual-help') {
                document.getElementById('title').innerText = 'BTS - Help'
                document.getElementById('view').innerText = 'Help';
                document.getElementById('view-contextual-help').style.display = 'block';
                updateMenu(name);
            } else if (name === 'system') {
                document.getElementById('title').innerText = 'BTS - System'
                document.getElementById('view').innerText = 'System';
                document.getElementById('view-setup').style.display = 'block';
                updateMenu(name);
            } else if (name === 'configuration') {
                document.getElementById('title').innerText = 'BTS - Setup'
                document.getElementById('view').innerText = 'Setup';
                document.getElementById('view-parameters').style.display = 'block';
                updateMenu(name);
            }
        }

        function showView() {
            const hash = window.location.hash || '#runtime'
            if (hash) {
                if (hash.startsWith('#detail-')) {
                    // changeView('runtime', document.getElementById('runtime'));
                    ['cards', 'overview-counts', 'view-batch', 'view-test-setup', 'view-battery-setup', 'view-system-setup'].forEach((v) => {
                        document.getElementById(v).style.display = 'none';
                    })
                    clickCard(hash.replace('#detail-', ''));
                } else {
                    changeView(hash.substring(1), document.getElementById(hash.substring(1)));
                }
            }
        }

        function showModal() {
            document.getElementById('modal').style.display = 'block';
        }

        function showRowMonikersOnDetailPage(toggle = true) {
            if (toggle) {
                show_row_monikers = !show_row_monikers;
                localStorage.setItem('show_row_monikers', show_row_monikers);
            }
            const elem = document.getElementById('option-show-row-monikers');
            elem.classList.remove('fa-toggle-on', 'fa-toggle-off', 'color-current', 'color-time');
            const classes = show_row_monikers === true ? ['fa-toggle-on', 'color-font'] : ['fa-toggle-off', 'color-time'];
            elem.classList.add(...classes);

            if (toggle) {
                window.location.reload();
            }
        }

        function showChargeDischargeOnTimeline(toggle = true) {
            if (toggle) {
                show_charge_discharge = !show_charge_discharge;
                localStorage.setItem('show_charge_discharge', show_charge_discharge);
            }
            const elem = document.getElementById('option_show_charge_discharge');
            elem.classList.remove('fa-toggle-on', 'fa-toggle-off', 'color-current', 'color-time');
            const classes = show_charge_discharge === true ? ['fa-toggle-on', 'color-font'] : ['fa-toggle-off', 'color-time'];
            elem.classList.add(...classes);

            if (toggle) {
                window.location.reload();
            }
        }

        function toggleMenuLocation(toggle = true) {
            if (toggle) {
                menu_location_bottom = !menu_location_bottom;
                localStorage.setItem('menu_location_bottom', menu_location_bottom);
            }
            const elem = document.getElementById('option_menu_location');
            elem.classList.remove('fa-toggle-on', 'fa-toggle-off', 'color-current', 'color-time');
            const classes = menu_location_bottom === true ? ['fa-toggle-on', 'color-font'] : ['fa-toggle-off', 'color-time'];
            elem.classList.add(...classes);

            if (toggle) {
                window.location.reload();
            }
        }

        window.addEventListener("popstate", (event) => {
            showView();
        });

        function clickBack() {
            history.back();
        }

        // FILTER
        function filter(value) {
            console.warn(value);
        }

        // EXPAND SYSTEM SETUP TABLE
        function expandTable(name, elem) {
            document.getElementById(name).style.maxHeight = '';
            elem.style.display = 'none';
        }

        // TIMELINE TOOLTIP
        function timelineTooltip(e) {
            console.log(e);
        }

        // FILTER RUNTIME
        function filterRuntime(name) {
            isSelected = document.getElementById(`filter_${name}`).classList.contains('filter-selected');
            ['on_test', 'paused', 'empty', 'complete', 'error'].forEach((v) => {
                document.getElementById(`filter_${v}`).classList.remove('filter-selected');
            });
            if (isSelected === true) {
                cards.items.forEach((v) => {
                    document.getElementById(`filter_${name}`).classList.remove('filter-selected');
                    [''].forEach((v2) => {
                        const elem = document.getElementById(`${v2}${v.name}`).parentElement;
                        elem.classList.remove('w3-hide');
                    });
                    ['table-row-', 'timeline-row-', 'batch-row-'].forEach((v2) => {
                        const elem = document.getElementById(`${v2}${v.name}`);
                        elem.classList.remove('w3-hide');
                    });
                });
            } else {
                document.getElementById(`filter_${name}`).classList.add('filter-selected');
                cards.items.forEach((v) => {
                    [''].forEach((v2) => {
                        const elem = document.getElementById(`${v2}${v.name}`).parentElement;
                        if (v.state !== name) {
                            elem.classList.add('w3-hide');
                        } else {
                            elem.classList.remove('w3-hide');
                            // elem.classList.add('w3-show');
                        }
                    });
                    ['table-row-', 'timeline-row-', 'batch-row-'].forEach((v2) => {
                        const elem = document.getElementById(`${v2}${v.name}`);
                        if (v.state !== name) {
                            elem.classList.add('w3-hide');
                        } else {
                            elem.classList.remove('w3-hide');
                            // elem.classList.add('w3-show');
                        }
                    });
                })
            }
            // const filtered = cards.items.filter((v) => v.state === name);
            // w3.displayObject("cards", cards);
            // w3.displayObject("cards", {items: filtered });

            // document.getElementById('content').style.display = 'block';
            // w3.displayObject("cards", cards);
            // selectCardType(card_type);
        }

        function toggleBathSelected(id) {
            const elem = document.getElementById(id);
            const isSelected = elem.classList.contains('fa-square-o');
            if (id.endsWith('-select-all')) {
                if (isSelected) {
                    cards.items.forEach((v) => {
                        const e = document.getElementById(`batch-row-${v.name}`);
                        if (e.classList.contains('w3-hide') === false) {
                            document.getElementById(`batch-row-${v.name}-selected`).classList.replace('fa-square-o', 'fa-check-square-o');
                        }
                    })
                } else {
                    cards.items.forEach((v) => {
                        document.getElementById(`batch-row-${v.name}-selected`).classList.replace('fa-check-square-o', 'fa-square-o');
                    })
                }
            }
            if (isSelected) {
                elem.classList.replace('fa-square-o', 'fa-check-square-o');
            } else {
                elem.classList.replace('fa-check-square-o', 'fa-square-o');
            }
        }

        //#region SETUP i/O ASSIGNMENT

        // SYSTEM SETUP CHANNEL ASSIGNMENT VIEW
        function changeChannelAssignmentView(view) {
            // const elemShared = document.getElementById('system-setup-channel-assignment-shared');
            const elemChannels = document.getElementById('system-setup-channel-assignment-channels');
            const elemLocations = document.getElementById('system-setup-channel-assignment-locations');

            // elemShared.classList.remove('card-menu-option-selected');
            elemChannels.classList.remove('card-menu-option-selected');
            elemLocations.classList.remove('card-menu-option-selected');

            // const elemSharedView = document.getElementById('channel-assignment-view-shared');
            const elemChannelsView = document.getElementById('channel-assignment-view-channels');
            const elemLocationsView = document.getElementById('channel-assignment-view-locations');

            // elemSharedView.style.display = 'none';
            elemChannelsView.style.display = 'none';
            elemLocationsView.style.display = 'none';


            // if (view === 'shared') {
            //     elemShared.classList.add('card-menu-option-selected');
            //     elemShared.style.borderBottom = '5px solid #75e0f0';
            //     elemLocations.style.borderBottom = '';
            //     elemChannels.style.borderBottom = '';
            //     // elemLocations.style.backgroundColor = '#2f2f2f';
            //     elemSharedView.style.display = 'block';
            // } else 
            if (view === 'channels') {
                elemChannels.classList.add('card-menu-option-selected');
                elemChannels.style.borderBottom = '5px solid #75e0f0';
                // elemShared.style.borderBottom = '';
                elemLocations.style.borderBottom = '';
                elemChannelsView.style.display = 'block';
            } else if (view === 'locations') {
                elemLocations.classList.add('card-menu-option-selected');
                elemLocations.style.borderBottom = '5px solid #75e0f0';
                // elemShared.style.borderBottom = '';
                elemChannels.style.borderBottom = '';
                elemLocationsView.style.display = 'block';
            }
        }
        //#endregion
    </script>

</body>

</html>